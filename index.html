<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flame | Bio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Mono', monospace; background: #000; color: white; overflow-x: hidden; }
        .glass { background: rgba(0,0,0,0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .scanline { position: fixed; inset: 0; background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.2) 50%); background-size: 100% 4px; pointer-events: none; z-index: 50; }
        input { background: #111; border: 1px solid #333; color: white; padding: 8px; border-radius: 4px; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="scanline"></div>

    <div id="editor-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="glass p-8 rounded-xl w-full max-w-md relative z-10 animate-fade">
            <h1 class="text-3xl font-bold mb-2 text-center text-red-500">FLAME</h1>
            <p class="text-xs text-gray-500 text-center mb-6">CREATE YOUR BIO</p>

            <label class="text-xs text-gray-400">USERNAME</label>
            <input id="in-user" type="text" placeholder="username" oninput="this.value = this.value.toLowerCase().replace(/[^a-z0-9]/g, '')">
            
            <label class="text-xs text-gray-400">PIN (Password)</label>
            <input id="in-pin" type="password" placeholder="1234">

            <div class="h-px bg-gray-800 my-4"></div>

            <label class="text-xs text-gray-400">BIO</label>
            <input id="in-bio" placeholder="I am a developer...">
            
            <label class="text-xs text-gray-400">BACKGROUND URL</label>
            <input id="in-bg" placeholder="https://...">
            
            <label class="text-xs text-gray-400">MUSIC URL</label>
            <input id="in-music" placeholder="https://...">

            <label class="text-xs text-gray-400">THEME COLOR</label>
            <input id="in-color" type="color" class="h-10 cursor-pointer" value="#ff0000">

            <button onclick="saveProfile()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded mt-4 transition">
                PUBLISH PROFILE
            </button>
        </div>
    </div>

    <div id="profile-screen" class="hidden fixed inset-0 flex items-center justify-center bg-black">
        <div id="p-bg" class="absolute inset-0 bg-cover bg-center opacity-50 transition-all duration-1000"></div>
        <div id="overlay" class="absolute inset-0 z-40 bg-black flex items-center justify-center cursor-pointer">
             <p class="text-xl animate-pulse tracking-widest text-red-500">click to enter</p>
        </div>
        <div id="card" class="glass p-10 rounded-2xl text-center max-w-md w-full mx-4 z-30 opacity-0 transform scale-90 transition-all duration-1000">
            <img id="p-pfp" class="w-28 h-28 rounded-full mx-auto mb-4 border-2 shadow-lg object-cover">
            <h1 id="p-name" class="text-4xl font-bold mb-2 drop-shadow-md"></h1>
            <p id="p-bio" class="text-sm text-gray-200 font-mono whitespace-pre-wrap"></p>
        </div>
        <audio id="p-audio" loop></audio>
    </div>

    <script>
        // ðŸ”´ PASTE YOUR ANON KEY BELOW (STARTS WITH eyJ...)
        const SB_URL = 'https://tevhzibiqhgzdedcruqo.supabase.co'; 
        const SB_KEY = 'PASTE_YOUR_LONG_ANON_KEY_HERE'; 

        const sb = supabase.createClient(SB_URL, SB_KEY);
        const path = window.location.pathname.replace('/', '');

        async function init() {
            if (!path || path === "index.html") document.getElementById('editor-screen').classList.remove('hidden');
            else loadProfile(path);
        }

        async function saveProfile() {
            const user = document.getElementById('in-user').value;
            const pin = document.getElementById('in-pin').value;
            if(!user || !pin) return alert("Username and PIN required");

            const newData = {
                username: user, pin: pin, 
                bio: document.getElementById('in-bio').value,
                bg_url: document.getElementById('in-bg').value,
                music_url: document.getElementById('in-music').value,
                color: document.getElementById('in-color').value
            };

            const { data: existing } = await sb.from('users').select('*').eq('username', user).single();
            
            if (existing) {
                if (existing.pin !== pin) return alert("Wrong PIN!");
                const { error } = await sb.from('users').update(newData).eq('username', user);
                if(error) alert(error.message); else window.location.href = "/" + user;
            } else {
                const { error } = await sb.from('users').insert(newData);
                if(error) alert(error.message); else window.location.href = "/" + user;
            }
        }

        async function loadProfile(username) {
            const { data: user, error } = await sb.from('users').select('*').eq('username', username).single();
            if(error || !user) return document.body.innerHTML = "<h1 class='text-center mt-10 text-red-500'>USER NOT FOUND</h1>";
            
            document.getElementById('profile-screen').classList.remove('hidden');
            document.getElementById('p-bg').style.backgroundImage = `url(${user.bg_url})`;
            document.getElementById('p-name').innerText = user.username;
            document.getElementById('p-name').style.color = user.color;
            document.getElementById('p-bio').innerText = user.bio;
            document.getElementById('p-pfp').src = `https://ui-avatars.com/api/?name=${user.username}&background=random&size=200`;
            document.getElementById('p-pfp').style.borderColor = user.color;
            if(user.music_url) document.getElementById('p-audio').src = user.music_url;

            document.getElementById('overlay').addEventListener('click', function() {
                this.remove();
                document.getElementById('p-bg').style.opacity = 1;
                document.getElementById('card').classList.remove('opacity-0', 'scale-90');
                if(user.music_url) document.getElementById('p-audio').play();
            });
        }
        init();
    </script>
</body>
</html>
